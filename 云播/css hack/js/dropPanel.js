(function(global,factory){if(typeof define==="function"&&(define.amd||define.cmd)){define(factory)}else{global.Follow=factory()}})(this,function(){$.fn.follow=function(trigger,options){var defaults={offsets:{x:0,y:0},position:"4-1",edgeAdjust:true};var params=$.extend({},defaults,options||{});return $(this).each(function(){var target=$(this);if(trigger.length==0){return}var pos,tri_h=0,tri_w=0,tri_l,tri_t,tar_l,tar_t,cor_l,cor_t,tar_h=target.data("height"),tar_w=target.data("width"),st=$(window).scrollTop(),sl=$(window).scrollLeft(),off_x=parseInt(params.offsets.x,10)||0,off_y=parseInt(params.offsets.y,10)||0,mousePos=this.cacheData;if(!tar_h){tar_h=target.outerHeight()}if(!tar_w){tar_w=target.outerWidth()}pos=trigger.offset();tri_h=trigger.outerHeight();tri_w=trigger.outerWidth();tri_l=pos.left;tri_t=pos.top;var funMouseL=function(){if(tri_l<0){tri_l=0}else if(tri_l+tri_h>$(window).width()){tri_l=$(window).width()-tri_w}},funMouseT=function(){if(tri_t<0){tri_t=0}else if(tri_t+tri_h>$(document).height()){tri_t=$(document).height()-tri_h}};var arrLegalPos=["4-1","1-4","5-7","2-3","2-1","6-8","3-4","4-3","8-6","1-2","7-5","3-2"],align=params.position,alignMatch=false,strDirect;$.each(arrLegalPos,function(i,n){if(n===align){alignMatch=true;return}});if(!alignMatch){align=defaults.position}var funDirect=function(a){var dir="bottom";switch(a){case"1-4":case"5-7":case"2-3":{dir="top";break}case"2-1":case"6-8":case"3-4":{dir="right";break}case"1-2":case"8-6":case"4-3":{dir="left";break}case"4-1":case"7-5":case"3-2":{dir="bottom";break}}return dir};var funCenterJudge=function(a){if(a==="5-7"||a==="6-8"||a==="8-6"||a==="7-5"){return true}return false};var funJudge=function(dir){var totalHeight=0,totalWidth=0;if(dir==="right"){totalWidth=tri_l+tri_w+tar_w+off_x;if(totalWidth>$(window).width()){return false}}else if(dir==="bottom"){totalHeight=tri_t+tri_h+tar_h+off_y;if(totalHeight>st+$(window).height()){return false}}else if(dir==="top"){totalHeight=tar_h+off_y;if(totalHeight>tri_t-st){return false}}else if(dir==="left"){totalWidth=tar_w+off_x;if(totalWidth>tri_l){return false}}return true};strDirect=funDirect(align);if(params.edgeAdjust){if(funJudge(strDirect)){(function(){if(funCenterJudge(align)){return}var obj={top:{right:"2-3",left:"1-4"},right:{top:"2-1",bottom:"3-4"},bottom:{right:"3-2",left:"4-1"},left:{top:"1-2",bottom:"4-3"}};var o=obj[strDirect],name;if(o){for(name in o){if(!funJudge(name)){align=o[name]}}}})()}else{(function(){if(funCenterJudge(align)){var center={"5-7":"7-5","7-5":"5-7","6-8":"8-6","8-6":"6-8"};align=center[align]}else{var obj={top:{left:"3-2",right:"4-1"},right:{bottom:"1-2",top:"4-3"},bottom:{left:"2-3",right:"1-4"},left:{bottom:"2-1",top:"3-4"}};var o=obj[strDirect],arr=[];for(name in o){arr.push(name)}if(funJudge(arr[0])||!funJudge(arr[1])){align=o[arr[0]]}else{align=o[arr[1]]}}})()}}var strNewDirect=funDirect(align),strFirst=align.split("-")[0];switch(strNewDirect){case"top":{tar_t=tri_t-tar_h;if(strFirst=="1"){tar_l=tri_l}else if(strFirst==="5"){tar_l=tri_l-(tar_w-tri_w)/2}else{tar_l=tri_l-(tar_w-tri_w)}break}case"right":{tar_l=tri_l+tri_w;if(strFirst=="2"){tar_t=tri_t}else if(strFirst==="6"){tar_t=tri_t-(tar_h-tri_h)/2}else{tar_t=tri_t-(tar_h-tri_h)}break}case"bottom":{tar_t=tri_t+tri_h;if(strFirst=="4"){tar_l=tri_l}else if(strFirst==="7"){tar_l=tri_l-(tar_w-tri_w)/2}else{tar_l=tri_l-(tar_w-tri_w)}break}case"left":{tar_l=tri_l-tar_w;if(strFirst=="2"){tar_t=tri_t}else if(strFirst==="6"){tar_t=tri_t-(tar_w-tri_w)/2}else{tar_t=tri_t-(tar_h-tri_h)}break}}if(params.edgeAdjust&&funCenterJudge(align)){var winWidth=$(window).width(),winHeight=$(window).height();if(align=="7-5"||align=="5-7"){if(tar_l-sl<.5*winWidth){if(tar_l-sl<0){tar_l=sl}}else if(tar_l-sl+tar_w>winWidth){tar_l=winWidth+sl-tar_w}}else{if(tar_t-st<.5*winHeight){if(tar_t-st<0){tar_t=st}}else if(tar_t-st+tar_h>winHeight){tar_t=winHeight+st-tar_h}}}if(strNewDirect=="top"||strNewDirect=="left"){tar_l=tar_l-off_x;tar_t=tar_t-off_y}else{tar_l=tar_l+off_x;tar_t=tar_t+off_y}target.css({position:"absolute",left:Math.round(tar_l),top:Math.round(tar_t)}).attr("data-align",align);var zIndex=target.css("zIndex")*1||19,maxIndex=zIndex;$("body").children().each(function(){var z,ele=this,el=$(ele);if(ele!==target[0]&&el.css("display")!=="none"&&(z=el.css("zIndex")*1)){maxIndex=Math.max(z,maxIndex)}});if(zIndex<maxIndex){target.css("zIndex",maxIndex+1)}})};var Follow=function(trigger,target,options){target.follow(trigger,options)};Follow.prototype.hide=function(){target.remove()};return Follow});(function(global,factory){if(typeof define==="function"&&(define.amd||define.cmd)){define(factory)}else{global.Drop=factory()}})(this,function(require,exports,module){if(typeof require=="function"){require("common/ui/Follow")}else if(!$().follow){if(window.console){console.error("need Follow.js")}return{}}$.fn.drop=function(target,options){return $(this).each(function(){var drop=$(this).data("drop");if(!drop){$(this).data("drop",new Drop($(this),target,options))}})};var Drop=function(trigger,target,options){var defaults={eventType:"null",selector:"",offsets:{x:0,y:0},edgeAdjust:true,position:"7-5",onShow:$.noop,onHide:$.noop};var params=$.extend({},defaults,options||{});this.el={};this.el.trigger=trigger;this.el.target=target;this.offsets=params.offsets;this.callback={show:params.onShow,hide:params.onHide};this.position=params.position;this.edgeAdjust=params.edgeAdjust;this.display=false;var drop=this;switch(params.eventType){case"null":{this.show();break}case"hover":{var timerHover;var timerHold;trigger.delegate(params.selector,"mouseenter",function(){drop.el.trigger=$(this);timerHover=setTimeout(function(){drop.show()},150);clearTimeout(timerHold)});trigger.delegate(params.selector,"mouseleave",function(){clearTimeout(timerHover);timerHold=setTimeout(function(){drop.hide()},200)});if(!target.data("dropHover")){target.hover(function(){clearTimeout(timerHold)},function(){timerHold=setTimeout(function(){drop.hide()},100)});target.data("dropHover",true)}break}case"click":{trigger.delegate(params.selector,"click",function(event){drop.el.trigger=$(this);if(drop.display==false){drop.show()}else{drop.hide()}event.preventDefault()});break}}if(params.eventType=="null"||params.eventType=="click"){$(document).mousedown(function(event){var clicked=event&&event.target;if(!clicked||!drop||drop.display!=true)return;var tri=drop.el.trigger.get(0),tar=drop.el.target.get(0);if(clicked!=tri&&clicked!=tar&&tri.contains(clicked)==false&&tar.contains(clicked)==false){drop.hide()}})}$(window).resize(function(){drop.follow()})};Drop.prototype.follow=function(){if(this.display=true&&this.el.trigger.css("display")!="none"){this.el.target.follow(this.el.trigger,{offsets:this.offsets,position:this.position,edgeAdjust:this.edgeAdjust})}};Drop.prototype.show=function(){var target=this.el.target;if(target&&$.contains(document.body,target.get(0))==false){$("body").append(target)}this.display=true;target.css("position","absolute").show();this.follow();if($.isFunction(this.callback.show)){this.callback.show.call(this,this.el.trigger,this.el.target)}};Drop.prototype.hide=function(){this.el.target.hide();this.display=false;if($.isFunction(this.callback.hide)){this.callback.hide.call(this,this.el.trigger,this.el.target)}};return Drop});(function(global,factory){if(typeof define==="function"&&(define.amd||define.cmd)){define(factory)}else{global.DropPanel=factory()}})(this,function(require){if(typeof require=="function"){require("common/ui/Drop")}else if(!$().drop){if(window.console){console.error("need Drop.js")}return{}}var prefixGlobal="ui_",joiner="_",prefixDropPanel="ui_dropanel_",SELECTED="selected",DISABLED="disabled";var svg=window.addEventListener?'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path d="M116.152,99.999l36.482-36.486c2.881-2.881,2.881-7.54,0-10.42 l-5.215-5.215c-2.871-2.881-7.539-2.881-10.42,0l-36.484,36.484L64.031,47.877c-2.881-2.881-7.549-2.881-10.43,0l-5.205,5.215 c-2.881,2.881-2.881,7.54,0,10.42l36.482,36.486l-36.482,36.482c-2.881,2.881-2.881,7.549,0,10.43l5.205,5.215 c2.881,2.871,7.549,2.871,10.43,0l36.484-36.488L137,152.126c2.881,2.871,7.549,2.871,10.42,0l5.215-5.215 c2.881-2.881,2.881-7.549,0-10.43L116.152,99.999z"/></svg>':"";var DropPanel=function(trigger,options){var defaults={title:"",content:"",buttons:[{},{}],width:"auto",eventType:"click",offsets:{x:0,y:0},onShow:$.noop,onHide:$.noop};var params=$.extend({},defaults,options||{});var target=$("<div></div>").addClass(prefixDropPanel+"x");if(/\d/.test(params.width)){target.width(params.width)}var el={};el.title=$("<h5></h5>").addClass(prefixDropPanel+"title").html(params.title);el.close=$("<a></a>").attr({href:"javascript:;"}).html(svg).addClass(prefixDropPanel+"close").click(function(){drop.hide()});el.content=$("<div></div>").addClass(prefixDropPanel+"content").html(params.content);el.footer=$("<div></div>").addClass(prefixDropPanel+"footer");$.each(params.buttons,function(i,btn){btn=btn||{};var type=i?btn.type||"":btn.type||"warning",value=i?btn.value||"取消":btn.value||"确定",events=btn.events||{click:function(){drop.hide()}};var cl=prefixGlobal+"button";if(type)cl=cl+" "+cl+joiner+type;el.footer.append(el["button"+i]=$('<a href="javascript:;" class="'+cl+'">'+value+"</a>").bind(events))});target.append(el.title).append(el.close).append(el.content).append(el.footer);trigger.drop(target,{eventType:params.eventType,offsets:params.offsets,onShow:params.onShow,onHide:params.onHide});var drop=trigger.data("drop");for(key in el){drop.el[key]=el[key]}return drop};return DropPanel});